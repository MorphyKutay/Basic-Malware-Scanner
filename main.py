import os
import hashlib
import time
import sys
sistem = os.name


def dosya_hash_hesapla(dosya_yolu):
    md5_hash = hashlib.md5()

    with open(dosya_yolu, "rb") as f:
        # Dosyanın büyük parçalarını parça parça oku ve hash değerini güncelle
        for byte_blok in iter(lambda: f.read(4096), b""):
            md5_hash.update(byte_blok)

    return md5_hash.hexdigest()



if sistem == 'nt':
    def tarama():
        for _ in range(5):  
            for i in range(3):
                sys.stdout.write("\rTarama Başladı" + "." * i + "   ")  
                sys.stdout.flush()  
                time.sleep(0.5)  
    tarama()

    def hashleri_txt_dosyasindan_oku(txt_dosya_yolu):
    
        hashlar = set()
        with open(txt_dosya_yolu, 'r') as f:
            for satir in f.readlines():
                hash_degeri = satir.strip()  # Sadece hash değerini alıyoruz.
                hashlar.add(hash_degeri)
        return hashlar

    def c_surusundeki_dosya_hashleri_ve_karsilastir(txt_dosya_yolu):
        c_surucusu_yolu = "C:\Program Files"
        txt_hashlar = hashleri_txt_dosyasindan_oku(txt_dosya_yolu)
    
        for klasor_yolu, _, dosya_isimleri in os.walk(c_surucusu_yolu):
            for dosya_adi in dosya_isimleri:
                dosya_yolu = os.path.join(klasor_yolu, dosya_adi)
            
                try:
                    hash_degeri = dosya_hash_hesapla(dosya_yolu)
                    if hash_degeri in txt_hashlar:
                        with open("virus.txt", "a") as f:
                            f.write(f"{dosya_yolu},{hash_degeri}\n")
                            print("---"*10)
                            print(f"virus bulundu!!! {dosya_yolu},{hash_degeri}\n")
                            virus_var = True
                except Exception as e:
                    print(f"Hata: {e} - {dosya_yolu}")
        if not virus_var:
            print("Sonuç Bulunamadı")
    txt_dosya_yolu = "virushashes.txt"
    c_surusundeki_dosya_hashleri_ve_karsilastir(txt_dosya_yolu)

else:
    print("coming soon")